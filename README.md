# Movie Rating Service

## Description in brief

### Technologies, Frameworks and Approach
- Spring boot application
- 3-layered application: controllers, services, dao
- API described by [openapi.yaml](./movie-rating-api/src/main/resources/openapi)
- DTOs used in controllers generated by `openapi-generator-maven-plugin` based on [openapi.yaml](./movie-rating-api/src/main/resources/openapi)
- PostgreSQL used as a underlying database
- Database tables are generated and filled in with initial data by init script as a part of docker-compose. For database change management I would use e.g. Liquibase in real project.
- Junit tests: I haven't covered all the code but I created 1 class with tests for controller (@WebMvcTest), 1 class with test for service layer (using JUnit and Mockito) and 1 test for DAO layer (@DataJpaTest). Just to show how I write them.
- Integration test: I've create integration tests for create/update/delete movie rating with use of `testcontainers` for DB level. It is a `@SpringBootTest` where I simply send HTTP requests to the application using `rest-assured` library. Once the requests are processed I check database records whether they were changed accordingly.
- To make some things easier the application runs on HTTP only as of now

### Monitoring
- Spring actuator with `micrometer-registry-prometheus` dependency that exposes prometheus metrics
- Prometheus scraper configured to watch /actuator/prometheus endpoint
- Prometheus configured as a Grafana datasource
- Spring Boot Dashboard (https://grafana.com/grafana/dashboards/10280-microservices-spring-boot-2-1/) configured as a default dashboard in Grafana
- Logback configured to push logs also to Loki so they are available also from Grafana

### Build and Run
- Maven used as a build tool. It is enough to run in project root directory 
``
mvn clean package
``
Please note that only jar file is built. For e.g. K8S deployment we would have to create a docker image (e.g. maven jib plugin or standard approach with Dockerfile).
- [docker-compose.yml](./docker/docker-compose.yml) created for quick start of dependencies so it can be tested on any environment. It contains a database with necessary tables and initial data, Prometheus and Grafana + Loki. It is enough to go to `docker` directory and run
``
docker compose up
``
- Once the project is compiled and dependencies run we can run the application from IDE using `com.github.movierating.MovieRatingApplication` class

